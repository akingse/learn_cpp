
### 分类

计算机中表示三维形体的模型，按照几何特点进行分类，大体上可以分为三种：
线框模型、表面模型和实体模型。
如果按照表示物体的方法进行分类，实体模型基本上可以分为
分解表示、构造表示CSG（Constructive Solid Geometry）和边界表示BREP（Boundary Representation）三大类。主流几何内核的做法是底层使用BREP结构，把CSG作为操作BREP结构的管理方法。

### 几何和拓扑

“几何”描述的是具体位置和形状，“拓扑”描述的是位置关系。
“几何”比较容易理解，就是我们通常所说的点，线，面，体。线又可以分为直线，线段，圆，圆弧，Nurbs曲线，贝赛尔曲线等各种线，面也类似可以分为平面，非参数曲面，参数方程定义的曲面等。而体则定义了各种实体，长方体，圆柱，球，圆环，组合体等

![[Pasted image 20240703231931.png]]

![[Pasted image 20240703231956.png]]

### BREP是万能的吗  

当然不是。

在很多领域，基于BRep的几何内核派不上用场。比如医疗行业，人的各种器官都是非常不规则的几何体，只能通过表面的三维细化面片重建。而基于BRep的拓扑几何结构过于重量化，海量的三角面片如果使用BRep，性能会非常差。

在CFD仿真中，大部分的模型都是基于面片数据，比如STL数据格式，而很少使用SAT，X_T，STEP等格式，即使使用了这些格式，最后也只是拿三角化后的数据。  

在很多专业设计领域，比如需要很多流线型的曲面曲线非等值面设计，基本都会使用专业的设计方法和工具，而不会使用BREP结构。  

对于一些复杂的数学方程和公式定义的异形几何，BREP也无能为力。



### 几何内核

将几何内核的功能进行分类，看看几何内核做了哪些事情，或者什么情况下上层应用会用到几何内核。

1. 二维草图

“草图”是一个专业术语。我们设计一个对象或者绘制一个对象时，开始很难用三维进行建模，通常的做法是先用二维表示，工程上的图纸一般也都是用二维表示，比如我们常见的俯视图，侧视图，截面图等等。AutoCAD之类的绘图设计软件最初都是二维的。

2. 三维实体建模，属性计算

三维实体建模是几何内核的基本功能。基于几何特征，几何内核需要提供完整的实体表达。

3. 历史系统



历史系统主要用来跟踪记录几何对象的变化信息。这些信息在参数建模和约束建模中要经常使用，是undo/redo机制的基础，同时也是几何模型质量的保证。

4. 属性系统



几何对象一般不会单独存在，几何对象上会有很多属性，比如颜色，显示方式，材料，业务类型，参数。对于数值仿真，还会有各种边界，荷载等信息。附加在几何上的属性系统也会涉及到增加，删除，修改，以及随几何变动而变动，比如两个不同属性的几何进行并运算，并之后新几何上的属性系统要有明确的设定。



5. 参数建模和约束建模

参数建模和约束建模都很好理解。底层需要有参数系统，基本功能包含参数表达，驱动更新，参数表达式计算，几何对象参数管理，以及约束求解器等等。这些功能是CAD软件几何设计(Design)的基础，而非Drawing



**几何拓扑，属性系统，历史系统，参数建模和约束建模构成了几何内核底层管理的基础。**

6. 几何离散化

几何内核要提供几何离散化功能，主要有两个目的：1. 生成基本的三角面片信息供渲染使用；2. 提供更多参数控制的面片的生成，以满足上层业务不同的需求。



7. 位置运算

位置运算提供各种几何之间的位置信息计算，常见的线线，点线，线面，点面，面面，面体，线体等各个维度几何的距离，相交，交点等信息。

通常位置运算需要大量使用计算几何或数值计算方法，这也是几何内核底层的基本功能之一



8. 布尔运算

布尔运算涉及到两个对象之间的合并，减，公共基本操作。在基本操作上衍生出切分，投影，缝补等操作。布尔运算主要涉及到线线，面面，面线的求交和裁剪运算，后续详细介绍。



**布尔运算的准确性，稳定性和性能是衡量一个几何内核质量的重要标准**



12. 几何清理修复

除非建立封闭的生态系统，否则这是几何内核工程应用的一个基础模块。在建模工程中，因为种种原因导致模型出现问题，比如各种拓扑和几何不满足设定条件或者出现错误。这种错误会导致模型本身的分析，比如面积，体积计算出错，还会导致仿真的网格划分出现错误。

13. 图形显示接口

几何内核本身是没有图形显示系统的。换言之，几何内核创建的数据无法直观的表现出来。为了将几何对象显示，需要和外部的图形显示引擎合作。

通常的做法是将几何对象离散化面片，然后送给图形显示引擎显示。离散化的面片和几何对象建立映射关系，以方便后续的操作。